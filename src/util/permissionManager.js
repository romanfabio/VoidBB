const globalMasks = new Map();

module.exports = {
    reload: async (database) => {

        const groups = await database.select('id', 'mask').from('GlobalGroups').orderBy('id');

        if (groups.length === 4) {
            globalMasks.clear();
            for (let i = 0; i < groups.length; i++) {
                globalMasks.set(groups[i].id, groups[i].mask);
            }
        } else {
            throw new Error('Can\'t reload global permissions: Global group quantity is not 4');
        }
    },

    GLOBAL_ANONYMOUS: 0,
    GLOBAL_USER: 1,
    GLOBAL_MODERATOR: 2,
    GLOBAL_ADMIN: 3,

    globalBit: {
        REGISTER: 0,
        VIEW_FORUM: 1,
        CREATE_FORUM: 2,
        VIEW_USER: 3,
        CHANGE_FORUM_PEX: 4
    },

    isGlobalSet: (groupId, bit) => {
        return globalMasks.get(groupId)[bit] == '1';
    },

    getGlobalMask: (groupId) => {
        return globalMasks.get(groupId);
    },

    forumBit: {
        A_CRT_POST: 0,
        A_CRT_COMMENT: 1,
        U_CRT_POST: 2,
        U_CRT_COMMENT: 3,
        M_CRT_POST: 128,
        M_CRT_COMMENT: 129
    },

    EMPTY_MASK:         '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    REQUIRED_ANONYMOUS: '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    REQUIRED_USER:      '110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    REQUIRED_MODERATOR: '110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',

    REQUIRED_FORUM_PEX: '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'

}